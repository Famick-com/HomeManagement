<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:zxing="clr-namespace:ZXing.Net.Maui.Controls;assembly=ZXing.Net.MAUI.Controls"
             x:Class="Famick.HomeManagement.Mobile.Pages.BarcodeScannerPage"
             Title="Scan Barcode"
             Shell.NavBarIsVisible="True"
             Shell.FlyoutBehavior="Disabled">

    <Grid>
        <!-- Scanner View - must be first, fills entire grid -->
        <zxing:CameraBarcodeReaderView
            x:Name="BarcodeReader"
            Options="{Binding BarcodeOptions}"
            BarcodesDetected="OnBarcodesDetected"
            IsDetecting="True"
            IsEnabled="True" />

        <!-- Overlay with scanning frame -->
        <Grid BackgroundColor="#80000000">
            <Border WidthRequest="280" HeightRequest="200"
                    BackgroundColor="Transparent"
                    Stroke="White"
                    StrokeThickness="3"
                    HorizontalOptions="Center"
                    VerticalOptions="Center">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="10" />
                </Border.StrokeShape>
            </Border>
        </Grid>

        <!-- Instructions at top -->
        <VerticalStackLayout VerticalOptions="Start" Padding="20" Margin="0,50,0,0">
            <Frame Padding="15" CornerRadius="10" HasShadow="False"
                   BackgroundColor="#E0FFFFFF">
                <Label x:Name="InstructionLabel"
                       Text="Point camera at barcode"
                       FontSize="14"
                       HorizontalTextAlignment="Center"
                       TextColor="Black" />
            </Frame>
        </VerticalStackLayout>

        <!-- Cancel button at bottom -->
        <VerticalStackLayout VerticalOptions="End" Padding="20" Margin="0,0,0,30">
            <Button
                Text="Cancel"
                Clicked="OnCancelClicked"
                HorizontalOptions="Center"
                BackgroundColor="#F44336"
                TextColor="White"
                CornerRadius="20"
                Padding="30,10" />
        </VerticalStackLayout>
    </Grid>
</ContentPage>
