<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:Famick.HomeManagement.Mobile.Models"
             x:Class="Famick.HomeManagement.Mobile.Pages.Contacts.ContactGroupEditPage"
             Title="New Household"
             Shell.NavBarIsVisible="True">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Save" Clicked="OnSaveClicked" />
    </ContentPage.ToolbarItems>

    <ScrollView Padding="16">
        <VerticalStackLayout Spacing="16">

            <!-- Type Picker -->
            <VerticalStackLayout Spacing="4">
                <Label Text="Type" FontSize="13" TextColor="Gray" />
                <Picker x:Name="TypePicker" SelectedIndexChanged="OnTypeChanged">
                    <Picker.Items>
                        <x:String>Household</x:String>
                        <x:String>Business</x:String>
                    </Picker.Items>
                </Picker>
            </VerticalStackLayout>

            <!-- Name -->
            <VerticalStackLayout Spacing="4">
                <Label x:Name="NameFieldLabel" Text="Household Name *" FontSize="13" TextColor="Gray" />
                <Entry x:Name="GroupNameEntry" Placeholder="e.g. Smith Family" />
            </VerticalStackLayout>

            <!-- Business Fields -->
            <VerticalStackLayout x:Name="BusinessFields" IsVisible="False" Spacing="16">
                <VerticalStackLayout Spacing="4">
                    <Label Text="Website" FontSize="13" TextColor="Gray" />
                    <Entry x:Name="WebsiteEntry" Placeholder="https://example.com" Keyboard="Url" />
                </VerticalStackLayout>
                <VerticalStackLayout Spacing="4">
                    <Label Text="Business Category" FontSize="13" TextColor="Gray" />
                    <Entry x:Name="CategoryEntry" Placeholder="e.g. Restaurant, Contractor" />
                </VerticalStackLayout>
            </VerticalStackLayout>

            <!-- Notes -->
            <VerticalStackLayout Spacing="4">
                <Label Text="Notes" FontSize="13" TextColor="Gray" />
                <Editor x:Name="NotesEditor" Placeholder="Optional notes..." HeightRequest="100"
                        AutoSize="TextChanges" />
            </VerticalStackLayout>

            <!-- Phone (Business only, create only) -->
            <VerticalStackLayout x:Name="PhoneField" IsVisible="False" Spacing="4">
                <Label Text="Phone" FontSize="13" TextColor="Gray" />
                <Entry x:Name="PhoneEntry" Placeholder="(555) 555-1234" Keyboard="Telephone" />
            </VerticalStackLayout>

            <!-- Tags -->
            <VerticalStackLayout Spacing="4">
                <Label Text="Tags" FontSize="13" TextColor="Gray" />
                <FlexLayout x:Name="TagsLayout"
                            Wrap="Wrap" JustifyContent="Start" Direction="Row" />
            </VerticalStackLayout>

            <!-- Address (create only) -->
            <VerticalStackLayout x:Name="AddressSection" IsVisible="False" Spacing="8">
                <BoxView HeightRequest="1" Color="{AppThemeBinding Light=#E0E0E0, Dark=#424242}" Margin="0,4" />
                <Label Text="Address" FontSize="16" FontAttributes="Bold" />
                <Entry x:Name="AddressLine1Entry" Placeholder="Address Line 1" TextChanged="OnAddressLine1TextChanged" />

                <!-- Search results dropdown -->
                <CollectionView x:Name="AddressSearchResultsView"
                                IsVisible="false"
                                MaximumHeightRequest="150"
                                SelectionMode="Single"
                                SelectionChanged="OnAddressSearchResultSelected"
                                Margin="0,-4,0,0">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:AddressDto">
                            <Border Padding="8,6" Margin="0,1"
                                    StrokeShape="RoundRectangle 6"
                                    Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#424242}"
                                    BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#333333}">
                                <VerticalStackLayout Spacing="2">
                                    <Label Text="{Binding AddressLine1}" FontSize="14" />
                                    <Label Text="{Binding DisplayAddress}" FontSize="12" TextColor="Gray" LineBreakMode="TailTruncation" />
                                </VerticalStackLayout>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <Label x:Name="SelectedAddressLabel"
                       IsVisible="false"
                       Text="Using existing address"
                       FontSize="13" TextColor="{AppThemeBinding Light=#1976D2, Dark=#64B5F6}" />

                <Entry x:Name="AddressLine2Entry" Placeholder="Address Line 2 (optional)" />
                <Entry x:Name="CityEntry" Placeholder="City" />
                <Grid ColumnDefinitions="*,*" ColumnSpacing="8">
                    <Entry x:Name="StateEntry" Grid.Column="0" Placeholder="State/Province" />
                    <Entry x:Name="PostalEntry" Grid.Column="1" Placeholder="Postal Code" />
                </Grid>
                <Entry x:Name="CountryEntry" Placeholder="Country" />
            </VerticalStackLayout>

            <!-- First Member (create only) -->
            <VerticalStackLayout x:Name="MemberSection" IsVisible="False" Spacing="8">
                <BoxView HeightRequest="1" Color="{AppThemeBinding Light=#E0E0E0, Dark=#424242}" Margin="0,4" />
                <Label Text="First Member (optional)" FontSize="16" FontAttributes="Bold" />
                <Grid ColumnDefinitions="*,*" ColumnSpacing="8">
                    <Entry x:Name="MemberFirstNameEntry" Grid.Column="0" Placeholder="First Name" />
                    <Entry x:Name="MemberLastNameEntry" Grid.Column="1" Placeholder="Last Name" />
                </Grid>
                <Grid ColumnDefinitions="*,*" ColumnSpacing="8">
                    <Entry x:Name="MemberEmailEntry" Grid.Column="0" Placeholder="Email" Keyboard="Email" />
                    <Entry x:Name="MemberPhoneEntry" Grid.Column="1" Placeholder="Phone" Keyboard="Telephone" />
                </Grid>
            </VerticalStackLayout>

            <ActivityIndicator x:Name="SavingIndicator" IsRunning="False" IsVisible="False"
                               HorizontalOptions="Center"
                               Color="{AppThemeBinding Light=#1976D2, Dark=#90CAF9}" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
